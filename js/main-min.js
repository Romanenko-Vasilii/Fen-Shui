$(document).ready(function(){$(".burger").on("click",function(){$(".info").slideToggle(300,function(){"none"===$(this).css("display")&&$(this).removeAttr("style")})});var t=$(".modal"),e=$("[data-toggle=modal]"),r=$(".modal__close");body=$(".body"),e.on("click",function(){t.toggleClass("modal--visible"),body.toggleClass("stop-scroll")}),r.on("click",function(){t.toggleClass("modal--visible"),body.toggleClass("stop-scroll")}),window.addEventListener("keydown",function(e){"27"==e.keyCode&&(t.removeClass("modal--visible"),body.removeClass("stop-scroll"))},!1),$('a[href^="#"]').click(function(){return headHeight=$(".head").height(),null!=document.getElementById($(this).attr("href").substr(1))&&(headHeight=$(".head").height()+150,$("html, body").animate({scrollTop:$($(this).attr("href")).offset().top-headHeight},1e3)),!1});var o=$(".header__head");$(window).scroll(function(){$(this).scrollTop()>400?o.addClass("fixd"):o.removeClass("fixd")});var n=$(".basket");$(window).scroll(function(){$(this).scrollTop()>400?n.addClass("fixd__basket"):n.removeClass("fixd__basket")});var a={add:function(t){a.products.push(t),a.refreshCookie(),a.refreshPrice(),a.addProductToOrder(t)},getPrice:function(){var t=0;return $.each(a.products,function(e,r){t+=parseInt(r.price)}),t},refreshPrice:function(){var t=a.getPrice();n.find(".total__price_amount").text(t),$("#modal__total__price_amount").text(t)},refreshOrder:function(){$("#modal__product_list").html(""),$.each(a.products,function(t,e){a.addProductToOrder(e)})},addProductToOrder:function(t){var e='        <div class="modal__product">\n          <div class="modal__product__img">\n            <img class="product__img" src="'+t.img+'" alt="#">\n          </div>\n          \x3c!-- /.modal__product__img --\x3e\n          <div class="modal__product__title">\n            <span class="modal__product__name">'+t.name+'</span>            <p class="modal__product__text modal__product__size_kind">'+t.sizeKind+'</p>\n            <p class="modal__product__text">'+t.structure+'</p>\n          </div>\n          \x3c!-- /.modal__product__title --\x3e\n          <div class="modal__buttom">\n            <button class="add add__plus">+</button>\n            <button class="add add__minus">&#8211</button>\n          </div>\n          \x3c!-- /.modal__buttom --\x3e\n          <div class="quantity"> Количество <br> <span class="lot">'+t.quantity+'</span> </div>\n          \x3c!-- /.quantity --\x3e\n          <div class="modal__price"> Стоимость <span class="cost">'+t.price+' р.</span></div>\n          \x3c!-- /.modal__price --\x3e\n          <div class="product__close"></div>\n      </div>';$("#modal__product_list").append(e)},searchProduct:function(t){for(var e=0;e<a.products.length;e++){var r=a.products[e];if(t.name===r.name&&t.sizeKind===r.sizeKind)return e}return!1},searchProductInOrder:function(t){var e=$(t).parents(".modal__product"),r={};return r.name=e.find(".modal__product__name").text().trim(),r.sizeKind=e.find(".modal__product__size_kind").text().trim(),r},getProductQuantity:function(t){var e=a.searchProduct(t);return!1!==e?a.products[e].quantity:0},changeQuantity:function(t,e){var r=a.products[t].price/a.products[t].quantity;a.products[t].price+=r*e,a.products[t].quantity+=e,a.refreshCookie(),a.refreshPrice(),a.refreshOrder()},removeProduct:function(t){a.products.splice(t,1),a.refreshCookie(),a.refreshPrice(),a.refreshOrder()},refreshCookie:function(){var t=JSON.stringify(a.products);localStorage.setItem("basket",t)}};$(".buy").click(function(){var t=$(this).parent(".size_kind");if(0===t.length)return console.log("Ошибка: у товара отсутствует размер"),!1;var e={};t.hasClass("small")?(e.sizeKind="стандарт",e.price=parseInt(t.find(".small__price").text().trim()),e.weight=t.find(".small__gramm").text().trim()):t.hasClass("big")&&(e.sizeKind="большой",e.price=parseInt(t.find(".big__price").text().trim()),e.weight=t.find(".big__gramm").text().trim());var r=$(t).parents(".wrap__product");e.name=r.find(".product__title").text().trim(),e.img=r.find(".product__img").attr("src"),e.structure=r.find(".product__structure").text().trim(),e.quantity=1;var o=a.searchProduct(e);!1===o?a.add(e):a.changeQuantity(o,1)}),$(document).on("click",".add__plus",function(){var t=a.searchProductInOrder(this),e=a.searchProduct(t);a.changeQuantity(e,1)}),$(document).on("click",".add__minus",function(){var t=a.searchProductInOrder(this),e=a.searchProduct(t);a.products[e].quantity>1&&a.changeQuantity(e,-1)}),$(document).on("click",".product__close",function(){var t=a.searchProductInOrder(this),e=a.searchProduct(t);a.removeProduct(e)}),a.products=null!=localStorage.getItem("basket")?JSON.parse(localStorage.getItem("basket")):[],a.refreshPrice(),a.refreshOrder(),$("form").submit(function(){$("#basket_input").val(JSON.stringify(a.products)),localStorage.removeItem("basket")}),$("form").validate({errorClass:"invalid",rules:{userName:{required:!0,minlength:2,maxlength:15},userPhone:"required"},messages:{userName:{required:"Имя обязательно",minlength:"Имя не короче двух букв",maxlength:"Имя не длиннее 15 букв"},userPhone:"Телефон обязателен"}}),$("[type=tel]").mask("8(000) 000-00-00",{placeholder:"8(___) ___-__-__"}),$(window).scroll(function(){$(this).scrollTop()>200?$("#button-up").fadeIn():$("#button-up").fadeOut()}),$("#button-up").click(function(){return $("body,html").animate({scrollTop:0},500),!1})});